<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI 손금 분석 - 사진을 올리면 생명선, 감정선, 두뇌선, 운명선을 분석합니다. 무료 손금 풀이, 손금 보는법, 손금 해석을 제공하는 프리미엄 서비스.">
    <meta name="keywords" content="손금, 손금분석, 손금풀이, 손금보는법, 손금해석, 생명선, 감정선, 두뇌선, 운명선, AI손금, 무료손금, 손금사진, 손바닥">
    <title>AI 손금 분석 | 사진으로 보는 내 손금 - 사주명리</title>
    <link rel="canonical" href="https://saju.gon.ai.kr/palm/">

    <!-- Naver Search Advisor -->
    <meta name="naver-site-verification" content="0e1c05903546c204ebb9e52263162fe36a32fb28" />

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="AI 손금 분석 | 사진으로 보는 내 손금">
    <meta property="og:description" content="손바닥 사진을 올리면 AI가 4대 손금선을 분석합니다. 생명선, 감정선, 두뇌선, 운명선 무료 분석.">
    <meta property="og:url" content="https://saju.gon.ai.kr/palm/">
    <meta property="og:image" content="https://saju.gon.ai.kr/assets/images/og-image.jpg">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:site_name" content="사주명리">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AI 손금 분석 | 사진으로 보는 내 손금">
    <meta name="twitter:description" content="손바닥 사진을 올리면 AI가 4대 손금선을 분석합니다.">

    <!-- Google AdSense -->
    <meta name="google-adsense-account" content="ca-pub-7479840445702290">

    <!-- Schema.org -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "AI 손금 분석",
        "description": "사진을 올리면 AI가 4대 손금선(생명선, 감정선, 두뇌선, 운명선)을 분석합니다",
        "url": "https://saju.gon.ai.kr/palm/",
        "applicationCategory": "Entertainment",
        "operatingSystem": "Web",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "KRW"
        },
        "isPartOf": {
            "@type": "WebSite",
            "name": "사주명리",
            "url": "https://saju.gon.ai.kr/"
        },
        "breadcrumb": {
            "@type": "BreadcrumbList",
            "itemListElement": [
                { "@type": "ListItem", "position": 1, "name": "홈", "item": "https://saju.gon.ai.kr/" },
                { "@type": "ListItem", "position": 2, "name": "손금 분석", "item": "https://saju.gon.ai.kr/palm/" }
            ]
        }
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "손금은 어떤 손으로 보나요?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "일반적으로 왼손은 타고난 운명(선천운), 오른손은 노력으로 만든 운명(후천운)을 나타냅니다. 주로 사용하는 손(오른손잡이는 오른손)을 위주로 보되, 양손을 함께 비교하면 더 정확합니다."
                }
            },
            {
                "@type": "Question",
                "name": "손금의 4대 주요선은 무엇인가요?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "4대 주요선은 생명선(체력·수명), 감정선(사랑·감성), 두뇌선(지능·사고방식), 운명선(경력·성공)입니다. 이 네 가지 선의 길이, 깊이, 형태에 따라 다양한 해석이 가능합니다."
                }
            },
            {
                "@type": "Question",
                "name": "손금은 변하나요?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "네, 손금은 시간이 지남에 따라 변할 수 있습니다. 생활 습관, 건강 상태, 심리적 변화에 따라 손금의 깊이나 길이가 달라질 수 있어, 정기적으로 확인하면 변화를 추적할 수 있습니다."
                }
            }
        ]
    }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500;700&family=Cormorant+Garamond:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/palm.css?v=7">

    <!-- Google AdSense Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7479840445702290"
         crossorigin="anonymous"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BNRL6FRMMM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-BNRL6FRMMM');
    </script>
</head>
<body>

    <!-- Header -->
    <header id="site-header">
        <nav class="container" style="display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.5rem;">
            <a href="/" class="logo-link" style="text-decoration: none;">
                <h1 style="font-family: var(--font-heading); font-size: var(--text-xl); margin: 0;">
                    <span class="gold-text">사주명리</span>
                </h1>
            </a>
            <nav class="nav-links">
                <a href="/">사주풀이</a>
                <a href="/zodiac/">띠별 운세</a>
                <a href="/daily/">오늘의 운세</a>
                <a href="/palm/" class="active">손금 분석</a>
            </nav>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="palm-hero">
        <div class="palm-hero-bg"></div>
        <div class="container palm-hero-content">
            <div class="palm-hero-badge">AI PALM READING</div>
            <h2 class="palm-hero-title">
                <span class="gold-text">AI 손금 분석</span>
            </h2>
            <p class="palm-hero-subtitle">손바닥 사진 한 장으로 읽는 당신의 운명</p>
            <p class="palm-hero-desc">동양 수상학의 지혜와 AI 기술이 만나, 4대 손금선의 비밀을 풀어드립니다</p>
        </div>
    </section>

    <!-- Upload Section -->
    <section class="palm-upload-section" id="upload-section">
        <div class="container">
            <div class="upload-card">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                            <path d="M32 8C18.745 8 8 18.745 8 32s10.745 24 24 24 24-10.745 24-24S45.255 8 32 8z" stroke="var(--color-gold)" stroke-width="1.5" fill="none" opacity="0.3"/>
                            <path d="M28 20h8l2 4h6a2 2 0 012 2v16a2 2 0 01-2 2H20a2 2 0 01-2-2V26a2 2 0 012-2h6l2-4z" stroke="var(--color-gold)" stroke-width="1.5" fill="none"/>
                            <circle cx="32" cy="33" r="6" stroke="var(--color-gold)" stroke-width="1.5" fill="none"/>
                        </svg>
                    </div>
                    <h3 class="upload-title">손바닥 사진을 올려주세요</h3>
                    <p class="upload-desc">사진을 드래그하거나 클릭하여 업로드</p>
                    <div class="upload-buttons">
                        <button class="upload-btn primary" id="btnUpload" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                            사진 업로드
                        </button>
                        <button class="upload-btn secondary" id="btnCamera" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
                            카메라 촬영
                        </button>
                    </div>
                    <input type="file" id="fileInput" accept="image/*" hidden>
                    <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden>
                </div>

                <!-- AI 상태 표시 -->
                <div class="ai-status-bar">
                    <span class="ai-indicator"></span>
                    <span id="aiStatus">AI 모델 로딩 중...</span>
                </div>

                <!-- 어떤 손으로? -->
                <div class="hand-select-guide">
                    <h4>어떤 손을 촬영하나요?</h4>
                    <p class="hand-guide-desc">양손 모두 가능합니다. AI가 왼손/오른손을 자동 인식합니다.</p>
                    <div class="hand-guide-items">
                        <div class="hand-guide-item">
                            <span class="hand-emoji">🤚</span>
                            <strong>왼손</strong> = 타고난 운명 (선천운)
                        </div>
                        <div class="hand-guide-item">
                            <span class="hand-emoji">✋</span>
                            <strong>오른손</strong> = 만들어가는 운명 (후천운)
                        </div>
                    </div>
                </div>

                <!-- 촬영 가이드 -->
                <div class="upload-guide">
                    <h4>촬영 가이드</h4>
                    <div class="guide-items">
                        <div class="guide-item">
                            <span class="guide-icon">💡</span>
                            <span>밝은 곳에서 촬영</span>
                        </div>
                        <div class="guide-item">
                            <span class="guide-icon">🤚</span>
                            <span>손바닥을 활짝 펴기</span>
                        </div>
                        <div class="guide-item">
                            <span class="guide-icon">📐</span>
                            <span>정면에서 가까이</span>
                        </div>
                        <div class="guide-item">
                            <span class="guide-icon">🔍</span>
                            <span>손금이 보이도록</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview + Canvas -->
            <div class="preview-container" id="previewContainer" style="display:none;">
                <div class="preview-card">
                    <div class="preview-image-wrapper">
                        <img id="previewImage" alt="업로드된 손바닥 사진">
                        <canvas id="overlayCanvas"></canvas>
                        <div class="line-legend" id="lineLegend" style="display:none;">
                            <div class="legend-item" data-line="heart"><span class="legend-color" style="background:#FF6B6B;"></span>감정선</div>
                            <div class="legend-item" data-line="head"><span class="legend-color" style="background:#4ECDC4;"></span>두뇌선</div>
                            <div class="legend-item" data-line="life"><span class="legend-color" style="background:#45B7D1;"></span>생명선</div>
                            <div class="legend-item" data-line="fate"><span class="legend-color" style="background:#DDA0DD;"></span>운명선</div>
                        </div>
                    </div>
                    <div class="preview-actions">
                        <button class="action-btn analyze" id="btnAnalyze" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                            손금 분석 시작
                        </button>
                        <button class="action-btn reset" id="btnReset" type="button">다시 선택</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Loading Animation -->
    <section class="palm-loading" id="loadingSection" style="display:none;">
        <div class="container">
            <div class="loading-card">
                <div class="loading-orb">
                    <div class="orb-ring"></div>
                    <div class="orb-ring delay-1"></div>
                    <div class="orb-ring delay-2"></div>
                    <div class="orb-core">🔮</div>
                </div>
                <h3 class="loading-text">손금을 분석하고 있습니다</h3>
                <p class="loading-sub" id="loadingStatus">AI 모델로 손바닥을 감지하는 중...</p>
                <div class="loading-bar">
                    <div class="loading-progress" id="loadingProgress"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analysis Results -->
    <section class="palm-results" id="resultsSection" style="display:none;">
        <div class="container">

            <!-- Summary Card -->
            <div class="result-summary-card">
                <div class="summary-header">
                    <h3 class="gold-text">분석 결과</h3>
                    <div class="summary-badge" id="summaryBadge">종합 점수</div>
                </div>
                <div class="summary-score-ring">
                    <svg viewBox="0 0 120 120" class="score-svg">
                        <circle cx="60" cy="60" r="52" fill="none" stroke="var(--color-border)" stroke-width="6"/>
                        <circle cx="60" cy="60" r="52" fill="none" stroke="url(#goldGradient)" stroke-width="6" stroke-linecap="round" stroke-dasharray="327" stroke-dashoffset="327" id="scoreCircle" transform="rotate(-90 60 60)"/>
                        <defs>
                            <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="var(--color-gold-light)"/>
                                <stop offset="100%" stop-color="var(--color-gold)"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <div class="score-text">
                        <span class="score-number" id="totalScore">0</span>
                        <span class="score-label">점</span>
                    </div>
                </div>
                <p class="summary-message" id="summaryMessage"></p>
            </div>

            <!-- 4 Main Lines -->
            <div class="lines-grid">
                <!-- 생명선 (Life Line) -->
                <div class="line-card" data-line="life">
                    <div class="line-card-header">
                        <div class="line-icon-circle life">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                        </div>
                        <div>
                            <h4 class="line-name">생명선</h4>
                            <span class="line-name-en">Life Line</span>
                        </div>
                        <div class="line-score" id="lifeScore">--</div>
                    </div>
                    <div class="line-bar-wrapper">
                        <div class="line-bar" id="lifeBar" style="width:0%"></div>
                    </div>
                    <div class="line-detail" id="lifeDetail">
                        <div class="detail-tags" id="lifeTags"></div>
                        <p class="detail-text" id="lifeText"></p>
                    </div>
                    <div class="line-extra" id="lifeExtra">
                        <h5>상세 해설</h5>
                        <div class="extra-content" id="lifeExtraContent"></div>
                    </div>
                </div>

                <!-- 감정선 (Heart Line) -->
                <div class="line-card" data-line="heart">
                    <div class="line-card-header">
                        <div class="line-icon-circle heart">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
                        </div>
                        <div>
                            <h4 class="line-name">감정선</h4>
                            <span class="line-name-en">Heart Line</span>
                        </div>
                        <div class="line-score" id="heartScore">--</div>
                    </div>
                    <div class="line-bar-wrapper">
                        <div class="line-bar heart" id="heartBar" style="width:0%"></div>
                    </div>
                    <div class="line-detail" id="heartDetail">
                        <div class="detail-tags" id="heartTags"></div>
                        <p class="detail-text" id="heartText"></p>
                    </div>
                    <div class="line-extra" id="heartExtra">
                        <h5>상세 해설</h5>
                        <div class="extra-content" id="heartExtraContent"></div>
                    </div>
                </div>

                <!-- 두뇌선 (Head Line) -->
                <div class="line-card" data-line="head">
                    <div class="line-card-header">
                        <div class="line-icon-circle head">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a7 7 0 017 7c0 2.38-1.19 4.47-3 5.74V17a2 2 0 01-2 2h-4a2 2 0 01-2-2v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 017-7z"/><path d="M9 21h6M10 17h4"/></svg>
                        </div>
                        <div>
                            <h4 class="line-name">두뇌선</h4>
                            <span class="line-name-en">Head Line</span>
                        </div>
                        <div class="line-score" id="headScore">--</div>
                    </div>
                    <div class="line-bar-wrapper">
                        <div class="line-bar head" id="headBar" style="width:0%"></div>
                    </div>
                    <div class="line-detail" id="headDetail">
                        <div class="detail-tags" id="headTags"></div>
                        <p class="detail-text" id="headText"></p>
                    </div>
                    <div class="line-extra" id="headExtra">
                        <h5>상세 해설</h5>
                        <div class="extra-content" id="headExtraContent"></div>
                    </div>
                </div>

                <!-- 운명선 (Fate Line) -->
                <div class="line-card" data-line="fate">
                    <div class="line-card-header">
                        <div class="line-icon-circle fate">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        </div>
                        <div>
                            <h4 class="line-name">운명선</h4>
                            <span class="line-name-en">Fate Line</span>
                        </div>
                        <div class="line-score" id="fateScore">--</div>
                    </div>
                    <div class="line-bar-wrapper">
                        <div class="line-bar fate" id="fateBar" style="width:0%"></div>
                    </div>
                    <div class="line-detail" id="fateDetail">
                        <div class="detail-tags" id="fateTags"></div>
                        <p class="detail-text" id="fateText"></p>
                    </div>
                    <div class="line-extra" id="fateExtra">
                        <h5>상세 해설</h5>
                        <div class="extra-content" id="fateExtraContent"></div>
                    </div>
                </div>
            </div>

            <!-- AI Deep Analysis Section -->
            <div class="additional-section" id="aiAnalysisSection" style="display:none;">
                <h3 class="section-title gold-text">AI 정밀 손금 분석</h3>
                <p class="section-subtitle" style="text-align:center; color: var(--color-text-muted); margin-bottom: 1.5rem;">AI가 분석한 상세 해석입니다</p>
                <div class="additional-grid">
                    <div class="additional-card" id="aiOverallCard">
                        <div class="additional-icon">🔮</div>
                        <h4>종합 해석</h4>
                        <p id="aiOverallText"></p>
                    </div>
                    <div class="additional-card" id="aiPersonalityCard">
                        <div class="additional-icon">🧠</div>
                        <h4>성격 분석</h4>
                        <p id="aiPersonalityText"></p>
                    </div>
                    <div class="additional-card" id="aiLoveCard">
                        <div class="additional-icon">💕</div>
                        <h4>연애운</h4>
                        <p id="aiLoveText"></p>
                    </div>
                    <div class="additional-card" id="aiCareerCard">
                        <div class="additional-icon">💼</div>
                        <h4>직업운 / 재물운</h4>
                        <p id="aiCareerText"></p>
                    </div>
                    <div class="additional-card" id="aiHealthCard">
                        <div class="additional-icon">🏥</div>
                        <h4>건강운</h4>
                        <p id="aiHealthText"></p>
                    </div>
                    <div class="additional-card" id="aiAdviceCard">
                        <div class="additional-icon">💡</div>
                        <h4>오늘의 조언</h4>
                        <p id="aiAdviceText"></p>
                    </div>
                    <div class="additional-card" id="aiAdditionalLinesCard" style="display:none; grid-column: 1 / -1;">
                        <div class="additional-icon">📐</div>
                        <h4>추가 손금선 분석</h4>
                        <div id="aiAdditionalLinesContent"></div>
                    </div>
                    <div class="additional-card" id="aiSpecialMarksCard" style="display:none; grid-column: 1 / -1;">
                        <div class="additional-icon">✨</div>
                        <h4>특수 기호 분석</h4>
                        <div id="aiSpecialMarksContent"></div>
                    </div>
                </div>
                <div class="ai-remaining" id="aiRemaining" style="text-align:center; margin-top:1rem; color: var(--color-text-muted); font-size: 0.85rem;"></div>
            </div>

            <!-- AI Loading Indicator (shown during API call) -->
            <div class="additional-section" id="aiLoadingSection" style="display:none;">
                <div style="text-align:center; padding: 2rem;">
                    <div class="loading-orb" style="margin: 0 auto 1rem;">
                        <div class="orb-ring"></div>
                        <div class="orb-ring delay-1"></div>
                        <div class="orb-core">🤖</div>
                    </div>
                    <h4 style="color: var(--color-gold);">AI가 손금을 정밀 분석하고 있습니다...</h4>
                    <p style="color: var(--color-text-muted); font-size: 0.9rem;">AI가 사진을 직접 분석하여 상세한 해석을 제공합니다</p>
                </div>
            </div>

            <!-- AI Error (rate limit) -->
            <div class="additional-section" id="aiErrorSection" style="display:none;">
                <div style="text-align:center; padding: 2rem;">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem;">⏰</div>
                    <h4 id="aiErrorTitle" style="color: var(--color-gold);">오늘의 AI 분석 횟수를 모두 사용했습니다</h4>
                    <p id="aiErrorText" style="color: var(--color-text-muted); font-size: 0.9rem;">내일 다시 이용해주세요. 위의 기본 분석 결과는 계속 확인하실 수 있습니다.</p>
                </div>
            </div>

            <!-- Share & Retry -->
            <div class="result-actions">
                <button class="action-btn analyze" id="btnRetry" type="button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6M23 20v-6h-6"/><path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"/></svg>
                    다시 분석하기
                </button>
            </div>
        </div>
    </section>

    <!-- Palm Reading Guide (SEO Content) -->
    <section class="palm-guide">
        <div class="container">
            <h2 class="section-title gold-text">손금 보는 법 완벽 가이드</h2>
            <p class="section-subtitle">수천 년의 역사를 가진 수상학(手相學)의 핵심을 알아보세요</p>

            <div class="guide-grid">
                <div class="guide-card">
                    <div class="guide-card-icon">🔴</div>
                    <h3>생명선 (Life Line)</h3>
                    <p>엄지와 검지 사이에서 시작하여 손목 방향으로 내려가는 선입니다. 체력, 활력, 전반적인 건강 상태를 나타냅니다.</p>
                    <ul class="guide-list">
                        <li><strong>길고 깊은 선</strong> — 강한 체력과 활력이 넘치는 삶</li>
                        <li><strong>짧고 얕은 선</strong> — 다른 사람의 지배를 받기 쉬운 성향</li>
                        <li><strong>곡선이 큰 선</strong> — 에너지가 풍부하고 열정적</li>
                        <li><strong>직선에 가까운 선</strong> — 신중하고 조심스러운 성격</li>
                        <li><strong>끊어진 선</strong> — 생활의 큰 변화나 건강 이슈</li>
                    </ul>
                </div>

                <div class="guide-card">
                    <div class="guide-card-icon">❤️</div>
                    <h3>감정선 (Heart Line)</h3>
                    <p>새끼손가락 아래에서 시작하여 검지 방향으로 이어지는 선입니다. 감정 표현, 연애 성향, 대인관계를 보여줍니다.</p>
                    <ul class="guide-list">
                        <li><strong>검지까지 닿는 선</strong> — 이상주의적 사랑관</li>
                        <li><strong>중지까지 닿는 선</strong> — 자기중심적 사랑</li>
                        <li><strong>곧고 짧은 선</strong> — 실용적이고 이성적인 성향</li>
                        <li><strong>구불구불한 선</strong> — 감정 기복이 있으나 풍부한 감성</li>
                        <li><strong>두뇌선과 만나는 선</strong> — 논리와 감정의 조화</li>
                    </ul>
                </div>

                <div class="guide-card">
                    <div class="guide-card-icon">🧠</div>
                    <h3>두뇌선 (Head Line)</h3>
                    <p>검지 아래에서 시작하여 손바닥을 가로지르는 선입니다. 지적 능력, 사고방식, 의사결정 스타일을 반영합니다.</p>
                    <ul class="guide-list">
                        <li><strong>긴 직선</strong> — 논리적이고 분석적인 사고</li>
                        <li><strong>아래로 휘어지는 선</strong> — 창의적이고 예술적 감각</li>
                        <li><strong>짧은 선</strong> — 직관적이고 빠른 판단력</li>
                        <li><strong>깊고 선명한 선</strong> — 집중력이 뛰어나고 기억력 우수</li>
                        <li><strong>갈라지는 선 (작가의 포크)</strong> — 상상력과 논리 모두 뛰어남</li>
                    </ul>
                </div>

                <div class="guide-card">
                    <div class="guide-card-icon">⭐</div>
                    <h3>운명선 (Fate Line)</h3>
                    <p>손바닥 중앙을 세로로 관통하는 선입니다. 인생의 방향, 직업운, 사회적 성취를 나타냅니다.</p>
                    <ul class="guide-list">
                        <li><strong>깊고 뚜렷한 선</strong> — 강한 의지와 목표 지향적 삶</li>
                        <li><strong>생명선에서 시작</strong> — 자수성가형, 스스로 길을 개척</li>
                        <li><strong>손목에서 시작</strong> — 어릴 때부터 진로가 뚜렷</li>
                        <li><strong>중간에 끊어짐</strong> — 직업이나 인생 방향의 전환</li>
                        <li><strong>운명선이 없는 경우</strong> — 자유로운 삶, 틀에 얽매이지 않음</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Special Signs Section -->
    <section class="palm-signs">
        <div class="container">
            <h2 class="section-title gold-text">손금의 특수 기호</h2>
            <div class="signs-grid">
                <div class="sign-item">
                    <div class="sign-symbol">☆</div>
                    <h4>별 (Star)</h4>
                    <p>행운과 성공의 상징. 위치에 따라 다양한 행운을 나타냅니다.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">△</div>
                    <h4>삼각형 (Triangle)</h4>
                    <p>지적 능력과 학문적 성취. 특히 두뇌선 위에 있으면 학자 기질.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">□</div>
                    <h4>사각형 (Square)</h4>
                    <p>보호의 의미. 선이 끊어진 곳에 있으면 위기를 극복하는 힘.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">✕</div>
                    <h4>십자가 (Cross)</h4>
                    <p>시련과 변화. 위치에 따라 정신적 성장이나 큰 결정을 의미.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">◯</div>
                    <h4>섬 (Island)</h4>
                    <p>에너지 분산이나 스트레스. 선 위에 있으면 해당 영역의 약화.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">⑃</div>
                    <h4>갈래 (Fork)</h4>
                    <p>선택과 다양성. 선 끝에 있으면 풍부한 경험과 다재다능함.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="palm-cta">
        <div class="container">
            <h2 class="gold-text">더 깊은 운명 분석이 궁금하다면</h2>
            <p>사주팔자로 당신의 타고난 운명을 풀어보세요</p>
            <div class="cta-links">
                <a href="/" class="cta-link primary">사주풀이 바로가기 →</a>
                <a href="/zodiac/" class="cta-link">2026년 띠별 운세 →</a>
                <a href="/daily/" class="cta-link">오늘의 운세 →</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="palm-footer">
        <div class="container">
            <p>© 2026 사주명리 — AI 손금 분석은 재미와 참고용이며, 의학적·법적 근거가 아닙니다.</p>
            <p class="footer-links">
                <a href="/">사주풀이</a> · <a href="/zodiac/">띠별 운세</a> · <a href="/daily/">오늘의 운세</a> · <a href="/palm/">손금 분석</a>
            </p>
        </div>
    </footer>

    <!-- Gemini AI 직접 분석 -->
    <script type="module">

    // AI 모델 상태 표시
    document.getElementById('aiStatus').textContent = 'AI 분석 준비 완료';
    document.getElementById('aiStatus').style.color = 'var(--color-gold)';

    // ===== DOM Elements =====
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const cameraInput = document.getElementById('cameraInput');
    const btnUpload = document.getElementById('btnUpload');
    const btnCamera = document.getElementById('btnCamera');
    const btnAnalyze = document.getElementById('btnAnalyze');
    const btnReset = document.getElementById('btnReset');
    const btnRetry = document.getElementById('btnRetry');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');
    const overlayCanvas = document.getElementById('overlayCanvas');
    const loadingSection = document.getElementById('loadingSection');
    const resultsSection = document.getElementById('resultsSection');
    const uploadSection = document.getElementById('upload-section');
    const lineLegend = document.getElementById('lineLegend');

    // ===== Image Handling =====
    let currentImageData = null;

    btnUpload.addEventListener('click', () => fileInput.click());
    btnCamera.addEventListener('click', () => cameraInput.click());
    fileInput.addEventListener('change', handleFileSelect);
    cameraInput.addEventListener('change', handleFileSelect);

    // Drag & Drop
    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('drag-over'); });
    uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('drag-over'); });
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault(); uploadArea.classList.remove('drag-over');
        if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
    });

    function handleFileSelect(e) { if (e.target.files.length > 0) handleFile(e.target.files[0]); }

    function handleFile(file) {
        if (!file.type.startsWith('image/')) { alert('이미지 파일만 업로드할 수 있습니다.'); return; }
        const reader = new FileReader();
        reader.onload = (e) => {
            currentImageData = e.target.result;
            previewImage.src = currentImageData;
            previewImage.onload = () => { setupCanvas(); showSection('preview'); };
        };
        reader.readAsDataURL(file);
    }

    function setupCanvas() {
        overlayCanvas.width = previewImage.naturalWidth;
        overlayCanvas.height = previewImage.naturalHeight;
        overlayCanvas.style.width = '100%';
        overlayCanvas.style.height = '100%';
    }

    // ===== Section Navigation =====
    const uploadCard = document.querySelector('.upload-card');

    function showSection(section) {
        // upload-section: upload, preview, results 모두에서 보임 (previewContainer가 안에 있으므로)
        uploadSection.style.display = (section === 'upload' || section === 'preview' || section === 'results') ? 'block' : 'none';
        uploadCard.style.display = section === 'upload' ? 'block' : 'none';
        previewContainer.style.display = (section === 'preview' || section === 'results') ? 'block' : 'none';
        loadingSection.style.display = section === 'loading' ? 'block' : 'none';
        resultsSection.style.display = section === 'results' ? 'block' : 'none';
    }

    // ===== Analysis =====
    btnAnalyze.addEventListener('click', startAnalysis);
    btnReset.addEventListener('click', resetAll);
    btnRetry.addEventListener('click', () => { resetAll(); window.scrollTo({ top: 0, behavior: 'smooth' }); });

    function resetAll() {
        currentImageData = null;
        fileInput.value = ''; cameraInput.value = '';
        lineLegend.style.display = 'none';
        overlayCanvas.getContext('2d').clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
        showSection('upload');
    }

    async function startAnalysis() {
        showSection('loading');
        window.scrollTo({ top: 0, behavior: 'smooth' });

        const loadingProgress = document.getElementById('loadingProgress');
        const loadingStatus = document.getElementById('loadingStatus');

        try {
        // 사용량 체크
        if (getAiUsageToday() >= AI_DAILY_LIMIT) {
            loadingStatus.textContent = '오늘의 AI 분석 횟수를 모두 사용했습니다. 내일 다시 시도해주세요.';
            loadingProgress.style.width = '100%';
            loadingProgress.style.background = '#ff4444';
            setTimeout(() => { loadingProgress.style.background = ''; showSection('preview'); }, 3000);
            return;
        }

        // Stage 1: 이미지 전송 준비
        loadingStatus.textContent = 'AI에 손금 사진을 전송하는 중...';
        loadingProgress.style.width = '20%';
        await sleep(300);

        // Stage 2: API 호출
        loadingStatus.textContent = 'AI가 손금을 분석하고 있습니다...';
        loadingProgress.style.width = '50%';

        const response = await fetch('/api/palm/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ image: currentImageData })
        });

        const data = await response.json();

        if (response.status === 429) {
            loadingStatus.textContent = data.message || '오늘의 AI 분석 횟수를 모두 사용했습니다.';
            loadingProgress.style.width = '100%';
            loadingProgress.style.background = '#ff4444';
            setTimeout(() => { loadingProgress.style.background = ''; showSection('preview'); }, 3000);
            return;
        }

        if (response.status === 503) {
            showBusyError();
            return;
        }

        if (data.error === 'not_palm') {
            showNotPalmError(data.message || '손바닥 사진이 아닌 것 같습니다.');
            return;
        }

        if (!response.ok) throw new Error(data.error || 'API error');

        // Stage 3: 결과 처리
        loadingStatus.textContent = '분석 결과를 정리하는 중...';
        loadingProgress.style.width = '90%';
        await sleep(300);

        incrementAiUsage();

        loadingProgress.style.width = '100%';
        await sleep(200);

        // 결과를 UI에 적용
        applyGeminiResults(data);
        showSection('results');
        animateResults();

        } catch (err) {
            console.error("[AI] Gemini 분석 오류:", err);
            showAnalysisError();
        }
    }

    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    // ===== Error Handlers =====
    function showNotPalmError(reason) {
        showSection('preview');
        // 재치있는 메시지 + 촬영 가이드
        const tips = [
            '손바닥을 활짝 펴고 카메라와 정면으로 맞춰주세요',
            '밝은 조명 아래서 촬영하면 손금이 더 잘 보입니다',
            '손바닥 전체가 사진에 들어오도록 가까이 찍어주세요',
            '손가락을 자연스럽게 펴고, 손금이 선명하게 보이도록 해주세요'
        ];
        const tipList = tips.map(t => `<li>${t}</li>`).join('');

        // 에러 오버레이 표시
        let overlay = document.getElementById('palmErrorOverlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'palmErrorOverlay';
            overlay.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;padding:1rem;';
            document.body.appendChild(overlay);
        }
        overlay.innerHTML = `
            <div style="background:var(--color-bg-secondary,#1a1a2e);border:1px solid var(--color-gold,#d4af37);border-radius:16px;padding:2rem;max-width:420px;width:100%;text-align:center;">
                <div style="font-size:3rem;margin-bottom:1rem;">🤔</div>
                <h3 style="color:var(--color-gold,#d4af37);margin-bottom:0.8rem;font-size:1.2rem;">손바닥을 찾지 못했어요</h3>
                <p style="color:var(--color-text,#e0d5c1);margin-bottom:1.2rem;font-size:0.95rem;line-height:1.6;">${reason}</p>
                <div style="text-align:left;background:rgba(212,175,55,0.08);border-radius:10px;padding:1rem;margin-bottom:1.2rem;">
                    <p style="color:var(--color-gold,#d4af37);font-weight:bold;margin-bottom:0.5rem;font-size:0.9rem;">📸 이렇게 찍어보세요!</p>
                    <ul style="color:var(--color-text-muted,#b8a88a);font-size:0.85rem;line-height:1.8;padding-left:1.2rem;margin:0;">
                        ${tipList}
                    </ul>
                </div>
                <button onclick="document.getElementById('palmErrorOverlay').style.display='none'"
                    style="background:var(--color-gold,#d4af37);color:#000;border:none;border-radius:8px;padding:0.7rem 2rem;font-size:1rem;font-weight:bold;cursor:pointer;">
                    다시 촬영하기
                </button>
            </div>
        `;
        overlay.style.display = 'flex';
    }

    function showBusyError() {
        showSection('preview');
        let overlay = document.getElementById('palmErrorOverlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'palmErrorOverlay';
            overlay.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;padding:1rem;';
            document.body.appendChild(overlay);
        }
        overlay.innerHTML = `
            <div style="background:var(--color-bg-secondary,#1a1a2e);border:1px solid var(--color-gold,#d4af37);border-radius:16px;padding:2rem;max-width:400px;width:100%;text-align:center;">
                <div style="font-size:3rem;margin-bottom:1rem;">⏳</div>
                <h3 style="color:var(--color-gold,#d4af37);margin-bottom:0.8rem;">AI가 잠시 바빠요</h3>
                <p style="color:var(--color-text-muted,#b8a88a);margin-bottom:1.2rem;font-size:0.9rem;line-height:1.6;">
                    많은 분들이 손금 분석을 이용 중이에요.<br>
                    <strong style="color:var(--color-text,#e0d5c1);">10~20초 후</strong>에 다시 시도해주세요!
                </p>
                <button onclick="document.getElementById('palmErrorOverlay').style.display='none'"
                    style="background:var(--color-gold,#d4af37);color:#000;border:none;border-radius:8px;padding:0.7rem 2rem;font-size:1rem;font-weight:bold;cursor:pointer;">
                    확인
                </button>
            </div>
        `;
        overlay.style.display = 'flex';
    }

    function showAnalysisError() {
        showSection('preview');
        let overlay = document.getElementById('palmErrorOverlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'palmErrorOverlay';
            overlay.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;padding:1rem;';
            document.body.appendChild(overlay);
        }
        overlay.innerHTML = `
            <div style="background:var(--color-bg-secondary,#1a1a2e);border:1px solid var(--color-gold,#d4af37);border-radius:16px;padding:2rem;max-width:400px;width:100%;text-align:center;">
                <div style="font-size:3rem;margin-bottom:1rem;">😅</div>
                <h3 style="color:var(--color-gold,#d4af37);margin-bottom:0.8rem;">분석에 실패했습니다</h3>
                <p style="color:var(--color-text-muted,#b8a88a);margin-bottom:1.2rem;font-size:0.9rem;line-height:1.6;">
                    일시적인 문제가 발생했어요.<br>
                    사진이 너무 어둡거나 흐리면 인식이 어려울 수 있습니다.<br>
                    밝은 곳에서 손바닥을 선명하게 다시 찍어보세요!
                </p>
                <button onclick="document.getElementById('palmErrorOverlay').style.display='none'"
                    style="background:var(--color-gold,#d4af37);color:#000;border:none;border-radius:8px;padding:0.7rem 2rem;font-size:1rem;font-weight:bold;cursor:pointer;">
                    다시 시도하기
                </button>
            </div>
        `;
        overlay.style.display = 'flex';
    }

    // ===== Gemini AI Analysis =====
    const AI_DAILY_LIMIT = 100;
    const AI_STORAGE_KEY = 'palm_ai_usage';

    function getAiUsageToday() {
        try {
            const data = JSON.parse(localStorage.getItem(AI_STORAGE_KEY) || '{}');
            const today = new Date().toISOString().slice(0, 10);
            if (data.date !== today) return 0;
            return data.count || 0;
        } catch { return 0; }
    }

    function incrementAiUsage() {
        const today = new Date().toISOString().slice(0, 10);
        const data = JSON.parse(localStorage.getItem(AI_STORAGE_KEY) || '{}');
        if (data.date !== today) {
            localStorage.setItem(AI_STORAGE_KEY, JSON.stringify({ date: today, count: 1 }));
        } else {
            data.count = (data.count || 0) + 1;
            localStorage.setItem(AI_STORAGE_KEY, JSON.stringify(data));
        }
    }

    // ===== Gemini 결과를 전체 UI에 적용 =====
    function applyGeminiResults(data) {
        // 라인 카드 채우기
        const lineMap = {
            heart_line: { dom: 'heart', name: '감정선' },
            head_line: { dom: 'head', name: '두뇌선' },
            life_line: { dom: 'life', name: '생명선' },
            fate_line: { dom: 'fate', name: '운명선' }
        };

        let totalScore = 0;
        let lineCount = 0;

        for (const [apiKey, info] of Object.entries(lineMap)) {
            const lineData = data.lines?.[apiKey];
            if (!lineData) continue;

            const score = lineData.score || 75;
            totalScore += score;
            lineCount++;

            document.getElementById(info.dom + 'Score').textContent = score;
            document.getElementById(info.dom + 'Bar').style.width = score + '%';
            document.getElementById(info.dom + 'Tags').innerHTML =
                (lineData.keywords || []).map(t => `<span class="tag">${t}</span>`).join('');
            document.getElementById(info.dom + 'Text').textContent = lineData.description || '';
            document.getElementById(info.dom + 'ExtraContent').textContent = '';
        }

        // 종합 점수
        const avg = lineCount > 0 ? Math.round(totalScore / lineCount) : 75;
        document.getElementById('totalScore').textContent = avg;
        document.getElementById('summaryBadge').textContent = `종합 ${avg}점`;

        const circle = document.getElementById('scoreCircle');
        const circumference = 2 * Math.PI * 52;
        const offset = circumference - (circumference * avg / 100);
        setTimeout(() => {
            circle.style.transition = 'stroke-dashoffset 1.5s ease-out';
            circle.style.strokeDashoffset = offset;
        }, 300);

        // 종합 메시지
        const handStr = data.hand || '손';
        let summaryText = '';
        if (avg >= 90) summaryText = '탁월한 손금입니다! 타고난 운과 재능이 조화를 이루고 있습니다.';
        else if (avg >= 80) summaryText = '매우 좋은 손금입니다. 균형 잡힌 기운이 긍정적인 영향을 줍니다.';
        else if (avg >= 70) summaryText = '좋은 손금입니다. 특별한 강점을 잘 활용하면 큰 성과를 거둘 수 있습니다.';
        else if (avg >= 60) summaryText = '안정적인 손금입니다. 꾸준한 노력이 좋은 결과로 이어질 기운입니다.';
        else summaryText = '잠재력이 큰 손금입니다. 자신을 믿고 도전하세요.';
        document.getElementById('summaryMessage').textContent = `[${handStr} 감지] ${summaryText}`;

        // AI 심층 분석 섹션
        document.getElementById('aiLoadingSection').style.display = 'none';
        document.getElementById('aiErrorSection').style.display = 'none';
        document.getElementById('aiOverallText').textContent = data.overall || '';
        document.getElementById('aiPersonalityText').textContent = data.personality || '';
        document.getElementById('aiLoveText').textContent = data.love || '';
        document.getElementById('aiCareerText').textContent = data.career || '';
        document.getElementById('aiHealthText').textContent = data.health || '';
        document.getElementById('aiAdviceText').textContent = data.advice || '';

        // 추가 손금선 분석 (결혼선, 태양선 등)
        const addLines = data.additional_lines || [];
        const addLinesCard = document.getElementById('aiAdditionalLinesCard');
        const addLinesContent = document.getElementById('aiAdditionalLinesContent');
        if (addLines.length > 0) {
            addLinesContent.innerHTML = addLines.map(line => {
                const s = line.score || 70;
                const tags = (line.keywords || []).map(t => `<span class="tag">${t}</span>`).join('');
                return `<div style="margin-bottom:1rem; padding:0.8rem; background:rgba(212,175,55,0.06); border-radius:8px; border-left:3px solid var(--color-primary);">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.4rem;">
                        <strong>${line.name}</strong> <span style="color:var(--color-primary); font-weight:bold;">${s}점</span>
                    </div>
                    <p style="margin:0 0 0.4rem; font-size:0.9rem;">${line.description}</p>
                    <div>${tags}</div>
                </div>`;
            }).join('');
            addLinesCard.style.display = 'block';
        } else {
            addLinesCard.style.display = 'none';
        }

        // 특수 기호 분석
        const marks = data.special_marks || [];
        const marksCard = document.getElementById('aiSpecialMarksCard');
        const marksContent = document.getElementById('aiSpecialMarksContent');
        if (marks.length > 0) {
            const symbolMap = { '별': '☆', '삼각형': '△', '사각형': '□', '십자': '✕', '섬': '◯', '갈래': '⑃' };
            marksContent.innerHTML = marks.map(m => {
                const sym = symbolMap[m.type] || '✦';
                return `<div style="margin-bottom:0.8rem; padding:0.6rem; background:rgba(212,175,55,0.08); border-radius:8px; border-left:3px solid var(--color-primary);">
                    <strong>${sym} ${m.type}</strong> <span style="color:var(--color-text-muted);">— ${m.location}</span>
                    <p style="margin:0.3rem 0 0; font-size:0.9rem;">${m.meaning}</p>
                </div>`;
            }).join('');
            marksCard.style.display = 'block';
        } else {
            marksContent.innerHTML = '<p style="color:var(--color-text-muted); font-size:0.9rem;">특수 기호가 발견되지 않았습니다.</p>';
            marksCard.style.display = 'block';
        }

        const remaining = data.remaining !== undefined ? data.remaining : (AI_DAILY_LIMIT - getAiUsageToday());
        document.getElementById('aiRemaining').textContent = `오늘 남은 AI 분석 횟수: ${remaining}회 / ${AI_DAILY_LIMIT}회`;
        document.getElementById('aiAnalysisSection').style.display = 'block';
    }

    // ===== Animate Results =====
    function animateResults() {
        const cards = resultsSection.querySelectorAll('.line-card, .result-summary-card, .additional-card');
        cards.forEach((card, i) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            setTimeout(() => {
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, i * 120);
        });
        setTimeout(() => {
            ['life', 'heart', 'head', 'fate'].forEach(line => {
                const bar = document.getElementById(line + 'Bar');
                const target = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => { bar.style.transition = 'width 1s ease-out'; bar.style.width = target; }, 100);
            });
        }, 400);
    }

    // ===== Line card expand/collapse =====
    document.querySelectorAll('.line-card').forEach(card => {
        card.addEventListener('click', function(e) {
            if (e.target.closest('.line-extra')) return;
            this.classList.toggle('expanded');
        });
    });

    // ===== Scroll Animations =====
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
    }, { threshold: 0.1 });
    document.querySelectorAll('.guide-card, .sign-item, .additional-card').forEach(el => observer.observe(el));

    </script>

</body>
</html>
