<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI 손금 분석 - 사진을 올리면 생명선, 감정선, 두뇌선, 운명선을 분석합니다. 무료 손금 풀이, 손금 보는법, 손금 해석을 제공하는 프리미엄 서비스.">
    <meta name="keywords" content="손금, 손금분석, 손금풀이, 손금보는법, 손금해석, 생명선, 감정선, 두뇌선, 운명선, AI손금, 무료손금, 손금사진, 손바닥">
    <title>AI 손금 분석 | 사진으로 보는 내 손금 - 사주명리</title>
    <link rel="canonical" href="https://saju.gon.ai.kr/palm/">

    <!-- Naver Search Advisor -->
    <meta name="naver-site-verification" content="0e1c05903546c204ebb9e52263162fe36a32fb28" />

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="AI 손금 분석 | 사진으로 보는 내 손금">
    <meta property="og:description" content="손바닥 사진을 올리면 AI가 4대 손금선을 분석합니다. 생명선, 감정선, 두뇌선, 운명선 무료 분석.">
    <meta property="og:url" content="https://saju.gon.ai.kr/palm/">
    <meta property="og:image" content="https://saju.gon.ai.kr/assets/images/og-image.jpg">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:site_name" content="사주명리">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AI 손금 분석 | 사진으로 보는 내 손금">
    <meta name="twitter:description" content="손바닥 사진을 올리면 AI가 4대 손금선을 분석합니다.">

    <!-- Google AdSense -->
    <meta name="google-adsense-account" content="ca-pub-7479840445702290">

    <!-- Schema.org -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "AI 손금 분석",
        "description": "사진을 올리면 AI가 4대 손금선(생명선, 감정선, 두뇌선, 운명선)을 분석합니다",
        "url": "https://saju.gon.ai.kr/palm/",
        "applicationCategory": "Entertainment",
        "operatingSystem": "Web",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "KRW"
        },
        "isPartOf": {
            "@type": "WebSite",
            "name": "사주명리",
            "url": "https://saju.gon.ai.kr/"
        },
        "breadcrumb": {
            "@type": "BreadcrumbList",
            "itemListElement": [
                { "@type": "ListItem", "position": 1, "name": "홈", "item": "https://saju.gon.ai.kr/" },
                { "@type": "ListItem", "position": 2, "name": "손금 분석", "item": "https://saju.gon.ai.kr/palm/" }
            ]
        }
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "손금은 어떤 손으로 보나요?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "일반적으로 왼손은 타고난 운명(선천운), 오른손은 노력으로 만든 운명(후천운)을 나타냅니다. 주로 사용하는 손(오른손잡이는 오른손)을 위주로 보되, 양손을 함께 비교하면 더 정확합니다."
                }
            },
            {
                "@type": "Question",
                "name": "손금의 4대 주요선은 무엇인가요?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "4대 주요선은 생명선(체력·수명), 감정선(사랑·감성), 두뇌선(지능·사고방식), 운명선(경력·성공)입니다. 이 네 가지 선의 길이, 깊이, 형태에 따라 다양한 해석이 가능합니다."
                }
            },
            {
                "@type": "Question",
                "name": "손금은 변하나요?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "네, 손금은 시간이 지남에 따라 변할 수 있습니다. 생활 습관, 건강 상태, 심리적 변화에 따라 손금의 깊이나 길이가 달라질 수 있어, 정기적으로 확인하면 변화를 추적할 수 있습니다."
                }
            }
        ]
    }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500;700&family=Cormorant+Garamond:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/palm.css?v=7">

    <!-- Google AdSense Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7479840445702290"
         crossorigin="anonymous"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BNRL6FRMMM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-BNRL6FRMMM');
    </script>
</head>
<body>

    <!-- Header -->
    <header id="site-header">
        <nav class="container" style="display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.5rem;">
            <a href="/" class="logo-link" style="text-decoration: none;">
                <h1 style="font-family: var(--font-heading); font-size: var(--text-xl); margin: 0;">
                    <span class="gold-text">사주명리</span>
                </h1>
            </a>
            <nav class="nav-links">
                <a href="/">사주풀이</a>
                <a href="/zodiac/">띠별 운세</a>
                <a href="/daily/">오늘의 운세</a>
                <a href="/palm/" class="active">손금 분석</a>
            </nav>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="palm-hero">
        <div class="palm-hero-bg"></div>
        <div class="container palm-hero-content">
            <div class="palm-hero-badge">AI PALM READING</div>
            <h2 class="palm-hero-title">
                <span class="gold-text">AI 손금 분석</span>
            </h2>
            <p class="palm-hero-subtitle">손바닥 사진 한 장으로 읽는 당신의 운명</p>
            <p class="palm-hero-desc">동양 수상학의 지혜와 AI 기술이 만나, 4대 손금선의 비밀을 풀어드립니다</p>
        </div>
    </section>

    <!-- Upload Section -->
    <section class="palm-upload-section" id="upload-section">
        <div class="container">
            <div class="upload-card">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                            <path d="M32 8C18.745 8 8 18.745 8 32s10.745 24 24 24 24-10.745 24-24S45.255 8 32 8z" stroke="var(--color-gold)" stroke-width="1.5" fill="none" opacity="0.3"/>
                            <path d="M28 20h8l2 4h6a2 2 0 012 2v16a2 2 0 01-2 2H20a2 2 0 01-2-2V26a2 2 0 012-2h6l2-4z" stroke="var(--color-gold)" stroke-width="1.5" fill="none"/>
                            <circle cx="32" cy="33" r="6" stroke="var(--color-gold)" stroke-width="1.5" fill="none"/>
                        </svg>
                    </div>
                    <h3 class="upload-title">손바닥 사진을 올려주세요</h3>
                    <p class="upload-desc">사진을 드래그하거나 클릭하여 업로드</p>
                    <div class="upload-buttons">
                        <button class="upload-btn primary" id="btnUpload" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                            사진 업로드
                        </button>
                        <button class="upload-btn secondary" id="btnCamera" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
                            카메라 촬영
                        </button>
                    </div>
                    <input type="file" id="fileInput" accept="image/*" hidden>
                    <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden>
                </div>

                <!-- AI 상태 표시 -->
                <div class="ai-status-bar">
                    <span class="ai-indicator"></span>
                    <span id="aiStatus">AI 모델 로딩 중...</span>
                </div>

                <!-- 어떤 손으로? -->
                <div class="hand-select-guide">
                    <h4>어떤 손을 촬영하나요?</h4>
                    <p class="hand-guide-desc">양손 모두 가능합니다. AI가 왼손/오른손을 자동 인식합니다.</p>
                    <div class="hand-guide-items">
                        <div class="hand-guide-item">
                            <span class="hand-emoji">🤚</span>
                            <strong>왼손</strong> = 타고난 운명 (선천운)
                        </div>
                        <div class="hand-guide-item">
                            <span class="hand-emoji">✋</span>
                            <strong>오른손</strong> = 만들어가는 운명 (후천운)
                        </div>
                    </div>
                </div>

                <!-- 촬영 가이드 -->
                <div class="upload-guide">
                    <h4>촬영 가이드</h4>
                    <div class="guide-items">
                        <div class="guide-item">
                            <span class="guide-icon">💡</span>
                            <span>밝은 곳에서 촬영</span>
                        </div>
                        <div class="guide-item">
                            <span class="guide-icon">🤚</span>
                            <span>손바닥을 활짝 펴기</span>
                        </div>
                        <div class="guide-item">
                            <span class="guide-icon">📐</span>
                            <span>정면에서 가까이</span>
                        </div>
                        <div class="guide-item">
                            <span class="guide-icon">🔍</span>
                            <span>손금이 보이도록</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview + Canvas -->
            <div class="preview-container" id="previewContainer" style="display:none;">
                <div class="preview-card">
                    <div class="preview-image-wrapper">
                        <img id="previewImage" alt="업로드된 손바닥 사진">
                        <canvas id="overlayCanvas"></canvas>
                        <div class="line-legend" id="lineLegend" style="display:none;">
                            <div class="legend-item" data-line="heart"><span class="legend-color" style="background:#FF6B6B;"></span>감정선</div>
                            <div class="legend-item" data-line="head"><span class="legend-color" style="background:#4ECDC4;"></span>두뇌선</div>
                            <div class="legend-item" data-line="life"><span class="legend-color" style="background:#45B7D1;"></span>생명선</div>
                            <div class="legend-item" data-line="fate"><span class="legend-color" style="background:#DDA0DD;"></span>운명선</div>
                        </div>
                    </div>
                    <div class="preview-actions">
                        <button class="action-btn analyze" id="btnAnalyze" type="button">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                            손금 분석 시작
                        </button>
                        <button class="action-btn reset" id="btnReset" type="button">다시 선택</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Loading Animation -->
    <section class="palm-loading" id="loadingSection" style="display:none;">
        <div class="container">
            <div class="loading-card">
                <div class="loading-orb">
                    <div class="orb-ring"></div>
                    <div class="orb-ring delay-1"></div>
                    <div class="orb-ring delay-2"></div>
                    <div class="orb-core">🔮</div>
                </div>
                <h3 class="loading-text">손금을 분석하고 있습니다</h3>
                <p class="loading-sub" id="loadingStatus">AI 모델로 손바닥을 감지하는 중...</p>
                <div class="loading-bar">
                    <div class="loading-progress" id="loadingProgress"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analysis Results -->
    <section class="palm-results" id="resultsSection" style="display:none;">
        <div class="container">

            <!-- Summary Card -->
            <div class="result-summary-card">
                <div class="summary-header">
                    <h3 class="gold-text">분석 결과</h3>
                    <div class="summary-badge" id="summaryBadge">종합 점수</div>
                </div>
                <div class="summary-score-ring">
                    <svg viewBox="0 0 120 120" class="score-svg">
                        <circle cx="60" cy="60" r="52" fill="none" stroke="var(--color-border)" stroke-width="6"/>
                        <circle cx="60" cy="60" r="52" fill="none" stroke="url(#goldGradient)" stroke-width="6" stroke-linecap="round" stroke-dasharray="327" stroke-dashoffset="327" id="scoreCircle" transform="rotate(-90 60 60)"/>
                        <defs>
                            <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="var(--color-gold-light)"/>
                                <stop offset="100%" stop-color="var(--color-gold)"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <div class="score-text">
                        <span class="score-number" id="totalScore">0</span>
                        <span class="score-label">점</span>
                    </div>
                </div>
                <p class="summary-message" id="summaryMessage"></p>
            </div>

            <!-- 4 Main Lines -->
            <div class="lines-grid">
                <!-- 생명선 (Life Line) -->
                <div class="line-card" data-line="life">
                    <div class="line-card-header">
                        <div class="line-icon-circle life">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                        </div>
                        <div>
                            <h4 class="line-name">생명선</h4>
                            <span class="line-name-en">Life Line</span>
                        </div>
                        <div class="line-score" id="lifeScore">--</div>
                    </div>
                    <div class="line-bar-wrapper">
                        <div class="line-bar" id="lifeBar" style="width:0%"></div>
                    </div>
                    <div class="line-detail" id="lifeDetail">
                        <div class="detail-tags" id="lifeTags"></div>
                        <p class="detail-text" id="lifeText"></p>
                    </div>
                    <div class="line-extra" id="lifeExtra">
                        <h5>상세 해설</h5>
                        <div class="extra-content" id="lifeExtraContent"></div>
                    </div>
                </div>

                <!-- 감정선 (Heart Line) -->
                <div class="line-card" data-line="heart">
                    <div class="line-card-header">
                        <div class="line-icon-circle heart">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
                        </div>
                        <div>
                            <h4 class="line-name">감정선</h4>
                            <span class="line-name-en">Heart Line</span>
                        </div>
                        <div class="line-score" id="heartScore">--</div>
                    </div>
                    <div class="line-bar-wrapper">
                        <div class="line-bar heart" id="heartBar" style="width:0%"></div>
                    </div>
                    <div class="line-detail" id="heartDetail">
                        <div class="detail-tags" id="heartTags"></div>
                        <p class="detail-text" id="heartText"></p>
                    </div>
                    <div class="line-extra" id="heartExtra">
                        <h5>상세 해설</h5>
                        <div class="extra-content" id="heartExtraContent"></div>
                    </div>
                </div>

                <!-- 두뇌선 (Head Line) -->
                <div class="line-card" data-line="head">
                    <div class="line-card-header">
                        <div class="line-icon-circle head">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a7 7 0 017 7c0 2.38-1.19 4.47-3 5.74V17a2 2 0 01-2 2h-4a2 2 0 01-2-2v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 017-7z"/><path d="M9 21h6M10 17h4"/></svg>
                        </div>
                        <div>
                            <h4 class="line-name">두뇌선</h4>
                            <span class="line-name-en">Head Line</span>
                        </div>
                        <div class="line-score" id="headScore">--</div>
                    </div>
                    <div class="line-bar-wrapper">
                        <div class="line-bar head" id="headBar" style="width:0%"></div>
                    </div>
                    <div class="line-detail" id="headDetail">
                        <div class="detail-tags" id="headTags"></div>
                        <p class="detail-text" id="headText"></p>
                    </div>
                    <div class="line-extra" id="headExtra">
                        <h5>상세 해설</h5>
                        <div class="extra-content" id="headExtraContent"></div>
                    </div>
                </div>

                <!-- 운명선 (Fate Line) -->
                <div class="line-card" data-line="fate">
                    <div class="line-card-header">
                        <div class="line-icon-circle fate">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        </div>
                        <div>
                            <h4 class="line-name">운명선</h4>
                            <span class="line-name-en">Fate Line</span>
                        </div>
                        <div class="line-score" id="fateScore">--</div>
                    </div>
                    <div class="line-bar-wrapper">
                        <div class="line-bar fate" id="fateBar" style="width:0%"></div>
                    </div>
                    <div class="line-detail" id="fateDetail">
                        <div class="detail-tags" id="fateTags"></div>
                        <p class="detail-text" id="fateText"></p>
                    </div>
                    <div class="line-extra" id="fateExtra">
                        <h5>상세 해설</h5>
                        <div class="extra-content" id="fateExtraContent"></div>
                    </div>
                </div>
            </div>

            <!-- AI Deep Analysis Section -->
            <div class="additional-section" id="aiAnalysisSection" style="display:none;">
                <h3 class="section-title gold-text">AI 정밀 손금 분석</h3>
                <p class="section-subtitle" style="text-align:center; color: var(--color-text-muted); margin-bottom: 1.5rem;">Gemini AI가 분석한 상세 해석입니다</p>
                <div class="additional-grid">
                    <div class="additional-card" id="aiOverallCard">
                        <div class="additional-icon">🔮</div>
                        <h4>종합 해석</h4>
                        <p id="aiOverallText"></p>
                    </div>
                    <div class="additional-card" id="aiPersonalityCard">
                        <div class="additional-icon">🧠</div>
                        <h4>성격 분석</h4>
                        <p id="aiPersonalityText"></p>
                    </div>
                    <div class="additional-card" id="aiLoveCard">
                        <div class="additional-icon">💕</div>
                        <h4>연애운</h4>
                        <p id="aiLoveText"></p>
                    </div>
                    <div class="additional-card" id="aiCareerCard">
                        <div class="additional-icon">💼</div>
                        <h4>직업운 / 재물운</h4>
                        <p id="aiCareerText"></p>
                    </div>
                    <div class="additional-card" id="aiHealthCard">
                        <div class="additional-icon">🏥</div>
                        <h4>건강운</h4>
                        <p id="aiHealthText"></p>
                    </div>
                    <div class="additional-card" id="aiAdviceCard">
                        <div class="additional-icon">💡</div>
                        <h4>오늘의 조언</h4>
                        <p id="aiAdviceText"></p>
                    </div>
                </div>
                <div class="ai-remaining" id="aiRemaining" style="text-align:center; margin-top:1rem; color: var(--color-text-muted); font-size: 0.85rem;"></div>
            </div>

            <!-- AI Loading Indicator (shown during API call) -->
            <div class="additional-section" id="aiLoadingSection" style="display:none;">
                <div style="text-align:center; padding: 2rem;">
                    <div class="loading-orb" style="margin: 0 auto 1rem;">
                        <div class="orb-ring"></div>
                        <div class="orb-ring delay-1"></div>
                        <div class="orb-core">🤖</div>
                    </div>
                    <h4 style="color: var(--color-gold);">AI가 손금을 정밀 분석하고 있습니다...</h4>
                    <p style="color: var(--color-text-muted); font-size: 0.9rem;">Gemini AI가 사진을 직접 분석하여 상세한 해석을 제공합니다</p>
                </div>
            </div>

            <!-- AI Error (rate limit) -->
            <div class="additional-section" id="aiErrorSection" style="display:none;">
                <div style="text-align:center; padding: 2rem;">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem;">⏰</div>
                    <h4 id="aiErrorTitle" style="color: var(--color-gold);">오늘의 AI 분석 횟수를 모두 사용했습니다</h4>
                    <p id="aiErrorText" style="color: var(--color-text-muted); font-size: 0.9rem;">내일 다시 이용해주세요. 위의 기본 분석 결과는 계속 확인하실 수 있습니다.</p>
                </div>
            </div>

            <!-- Share & Retry -->
            <div class="result-actions">
                <button class="action-btn analyze" id="btnRetry" type="button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6M23 20v-6h-6"/><path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"/></svg>
                    다시 분석하기
                </button>
            </div>
        </div>
    </section>

    <!-- Palm Reading Guide (SEO Content) -->
    <section class="palm-guide">
        <div class="container">
            <h2 class="section-title gold-text">손금 보는 법 완벽 가이드</h2>
            <p class="section-subtitle">수천 년의 역사를 가진 수상학(手相學)의 핵심을 알아보세요</p>

            <div class="guide-grid">
                <div class="guide-card">
                    <div class="guide-card-icon">🔴</div>
                    <h3>생명선 (Life Line)</h3>
                    <p>엄지와 검지 사이에서 시작하여 손목 방향으로 내려가는 선입니다. 체력, 활력, 전반적인 건강 상태를 나타냅니다.</p>
                    <ul class="guide-list">
                        <li><strong>길고 깊은 선</strong> — 강한 체력과 활력이 넘치는 삶</li>
                        <li><strong>짧고 얕은 선</strong> — 다른 사람의 지배를 받기 쉬운 성향</li>
                        <li><strong>곡선이 큰 선</strong> — 에너지가 풍부하고 열정적</li>
                        <li><strong>직선에 가까운 선</strong> — 신중하고 조심스러운 성격</li>
                        <li><strong>끊어진 선</strong> — 생활의 큰 변화나 건강 이슈</li>
                    </ul>
                </div>

                <div class="guide-card">
                    <div class="guide-card-icon">❤️</div>
                    <h3>감정선 (Heart Line)</h3>
                    <p>새끼손가락 아래에서 시작하여 검지 방향으로 이어지는 선입니다. 감정 표현, 연애 성향, 대인관계를 보여줍니다.</p>
                    <ul class="guide-list">
                        <li><strong>검지까지 닿는 선</strong> — 이상주의적 사랑관</li>
                        <li><strong>중지까지 닿는 선</strong> — 자기중심적 사랑</li>
                        <li><strong>곧고 짧은 선</strong> — 실용적이고 이성적인 성향</li>
                        <li><strong>구불구불한 선</strong> — 감정 기복이 있으나 풍부한 감성</li>
                        <li><strong>두뇌선과 만나는 선</strong> — 논리와 감정의 조화</li>
                    </ul>
                </div>

                <div class="guide-card">
                    <div class="guide-card-icon">🧠</div>
                    <h3>두뇌선 (Head Line)</h3>
                    <p>검지 아래에서 시작하여 손바닥을 가로지르는 선입니다. 지적 능력, 사고방식, 의사결정 스타일을 반영합니다.</p>
                    <ul class="guide-list">
                        <li><strong>긴 직선</strong> — 논리적이고 분석적인 사고</li>
                        <li><strong>아래로 휘어지는 선</strong> — 창의적이고 예술적 감각</li>
                        <li><strong>짧은 선</strong> — 직관적이고 빠른 판단력</li>
                        <li><strong>깊고 선명한 선</strong> — 집중력이 뛰어나고 기억력 우수</li>
                        <li><strong>갈라지는 선 (작가의 포크)</strong> — 상상력과 논리 모두 뛰어남</li>
                    </ul>
                </div>

                <div class="guide-card">
                    <div class="guide-card-icon">⭐</div>
                    <h3>운명선 (Fate Line)</h3>
                    <p>손바닥 중앙을 세로로 관통하는 선입니다. 인생의 방향, 직업운, 사회적 성취를 나타냅니다.</p>
                    <ul class="guide-list">
                        <li><strong>깊고 뚜렷한 선</strong> — 강한 의지와 목표 지향적 삶</li>
                        <li><strong>생명선에서 시작</strong> — 자수성가형, 스스로 길을 개척</li>
                        <li><strong>손목에서 시작</strong> — 어릴 때부터 진로가 뚜렷</li>
                        <li><strong>중간에 끊어짐</strong> — 직업이나 인생 방향의 전환</li>
                        <li><strong>운명선이 없는 경우</strong> — 자유로운 삶, 틀에 얽매이지 않음</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Special Signs Section -->
    <section class="palm-signs">
        <div class="container">
            <h2 class="section-title gold-text">손금의 특수 기호</h2>
            <div class="signs-grid">
                <div class="sign-item">
                    <div class="sign-symbol">☆</div>
                    <h4>별 (Star)</h4>
                    <p>행운과 성공의 상징. 위치에 따라 다양한 행운을 나타냅니다.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">△</div>
                    <h4>삼각형 (Triangle)</h4>
                    <p>지적 능력과 학문적 성취. 특히 두뇌선 위에 있으면 학자 기질.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">□</div>
                    <h4>사각형 (Square)</h4>
                    <p>보호의 의미. 선이 끊어진 곳에 있으면 위기를 극복하는 힘.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">✕</div>
                    <h4>십자가 (Cross)</h4>
                    <p>시련과 변화. 위치에 따라 정신적 성장이나 큰 결정을 의미.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">◯</div>
                    <h4>섬 (Island)</h4>
                    <p>에너지 분산이나 스트레스. 선 위에 있으면 해당 영역의 약화.</p>
                </div>
                <div class="sign-item">
                    <div class="sign-symbol">⑃</div>
                    <h4>갈래 (Fork)</h4>
                    <p>선택과 다양성. 선 끝에 있으면 풍부한 경험과 다재다능함.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="palm-cta">
        <div class="container">
            <h2 class="gold-text">더 깊은 운명 분석이 궁금하다면</h2>
            <p>사주팔자로 당신의 타고난 운명을 풀어보세요</p>
            <div class="cta-links">
                <a href="/" class="cta-link primary">사주풀이 바로가기 →</a>
                <a href="/zodiac/" class="cta-link">2026년 띠별 운세 →</a>
                <a href="/daily/" class="cta-link">오늘의 운세 →</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="palm-footer">
        <div class="container">
            <p>© 2026 사주명리 — AI 손금 분석은 재미와 참고용이며, 의학적·법적 근거가 아닙니다.</p>
            <p class="footer-links">
                <a href="/">사주풀이</a> · <a href="/zodiac/">띠별 운세</a> · <a href="/daily/">오늘의 운세</a> · <a href="/palm/">손금 분석</a>
            </p>
        </div>
    </footer>

    <!-- MediaPipe Hand Landmarker -->
    <script type="module">
    import { HandLandmarker, FilesetResolver }
        from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.18/vision_bundle.mjs";

    // ===== MediaPipe AI Model =====
    let handLandmarker = null;
    let detectedLandmarks = null; // 실제 감지된 21개 관절점
    let handedness = null;

    async function initMediaPipe() {
        try {
            const vision = await FilesetResolver.forVisionTasks(
                "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.18/wasm"
            );
            // GPU 먼저 시도, 실패 시 CPU fallback
            try {
                handLandmarker = await HandLandmarker.createFromOptions(vision, {
                    baseOptions: {
                        modelAssetPath: "https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",
                        delegate: "GPU"
                    },
                    runningMode: "IMAGE",
                    numHands: 2,
                    minHandDetectionConfidence: 0.3,
                    minHandPresenceConfidence: 0.3
                });
                console.log("[AI] MediaPipe Hand Landmarker 초기화 완료 (GPU)");
            } catch (gpuErr) {
                console.warn("[AI] GPU 실패, CPU fallback:", gpuErr);
                handLandmarker = await HandLandmarker.createFromOptions(vision, {
                    baseOptions: {
                        modelAssetPath: "https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",
                        delegate: "CPU"
                    },
                    runningMode: "IMAGE",
                    numHands: 2,
                    minHandDetectionConfidence: 0.3,
                    minHandPresenceConfidence: 0.3
                });
                console.log("[AI] MediaPipe Hand Landmarker 초기화 완료 (CPU)");
            }
            document.getElementById('aiStatus').textContent = 'AI 모델 준비 완료';
            document.getElementById('aiStatus').style.color = 'var(--color-gold)';
        } catch (err) {
            console.error("[AI] MediaPipe 초기화 실패:", err);
            document.getElementById('aiStatus').textContent = 'AI 모델 로딩 중... (잠시 후 다시 시도)';
        }
    }

    // 페이지 로드 시 즉시 초기화
    initMediaPipe();

    // ===== DOM Elements =====
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const cameraInput = document.getElementById('cameraInput');
    const btnUpload = document.getElementById('btnUpload');
    const btnCamera = document.getElementById('btnCamera');
    const btnAnalyze = document.getElementById('btnAnalyze');
    const btnReset = document.getElementById('btnReset');
    const btnRetry = document.getElementById('btnRetry');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');
    const overlayCanvas = document.getElementById('overlayCanvas');
    const loadingSection = document.getElementById('loadingSection');
    const resultsSection = document.getElementById('resultsSection');
    const uploadSection = document.getElementById('upload-section');
    const lineLegend = document.getElementById('lineLegend');

    // ===== Palm Line Interpretation Data =====
    const palmInterpretations = {
        life: {
            long:   { score: 92, tags: ['강한 체력', '활력 충만', '장수'], text: '매우 강한 생명력을 가지고 있습니다. 체력이 뛰어나고 질병에 대한 저항력이 높으며, 활기찬 삶을 영위할 수 있는 타고난 건강 체질입니다.', extra: '생명선이 길고 깊다는 것은 기초 체력이 튼튼하다는 의미입니다. 활동적인 라이프스타일을 유지하면 더 큰 활력을 얻을 수 있으며, 노후에도 건강한 상태를 유지할 가능성이 높습니다.' },
            curved: { score: 87, tags: ['열정적', '에너지 충만', '적극적'], text: '넘치는 에너지와 열정의 소유자입니다. 새로운 경험에 대한 호기심이 강하고, 적극적으로 인생을 개척해 나가는 타입입니다.', extra: '크게 휘어진 생명선은 감정적으로 풍부하고 인생을 능동적으로 살아가는 사람에게 많이 보입니다.' },
            straight:{ score: 78, tags: ['신중함', '조심성', '계획적'], text: '신중하고 계획적인 성격의 소유자입니다. 모험보다는 안정을 추구하며, 꼼꼼하게 계획을 세워 실행하는 스타일입니다.', extra: '직선에 가까운 생명선은 이성적이고 논리적인 판단력을 의미합니다.' },
            short:  { score: 72, tags: ['집중력', '순간 에너지', '도전적'], text: '짧은 생명선은 수명과 무관합니다. 순간적인 집중력과 폭발적인 에너지를 보여주는 사람에게 많이 나타납니다.', extra: '짧고 선명한 생명선은 효율적인 에너지 사용을 의미합니다.' }
        },
        heart: {
            long:   { score: 90, tags: ['풍부한 감성', '로맨틱', '배려심'], text: '감성이 풍부하고 로맨틱한 성향입니다. 타인에 대한 공감 능력이 뛰어나며, 깊고 의미 있는 관계를 형성합니다.', extra: '길고 곡선인 감정선은 사랑과 우정에서 깊은 유대를 형성하는 사람에게 나타납니다.' },
            curved: { score: 88, tags: ['이상주의', '순수한 사랑', '헌신적'], text: '이상적인 사랑을 추구하는 낭만주의자입니다. 순수하고 헌신적인 사랑을 하며, 파트너에게 최선을 다합니다.', extra: '곡선이 큰 감정선은 높은 이상과 기준을 가진 사람에게 나타납니다.' },
            straight:{ score: 82, tags: ['이성적', '실용적', '안정적'], text: '감정을 이성적으로 다루는 타입입니다. 관계에서 안정감을 중시하며, 현실적이고 실용적인 사랑을 추구합니다.', extra: '직선형 감정선은 감정에 휩쓸리지 않는 냉정한 판단력을 의미합니다.' },
            short:  { score: 75, tags: ['독립적', '자유로운', '개인주의'], text: '독립적이고 자유로운 영혼입니다. 개인의 자유를 중시하며, 구속 받지 않는 관계를 선호합니다.', extra: '짧은 감정선은 자기만의 시간과 공간을 소중히 여기는 사람에게 많이 나타납니다.' }
        },
        head: {
            long:   { score: 91, tags: ['논리적', '분석적', '학자형'], text: '뛰어난 논리력과 분석력의 소유자입니다. 복잡한 문제를 체계적으로 해결하며, 학문이나 연구 분야에서 큰 성과를 거둘 수 있습니다.', extra: '길고 직선인 두뇌선은 뛰어난 집중력과 논리적 사고력을 의미합니다.' },
            curved: { score: 86, tags: ['창의적', '예술적', '상상력'], text: '풍부한 상상력과 창의력을 가지고 있습니다. 예술, 문학, 디자인 등 창작 분야에서 독보적인 재능을 발휘할 수 있습니다.', extra: '아래로 휘어진 두뇌선은 강한 상상력과 창조적 사고를 나타냅니다.' },
            straight:{ score: 85, tags: ['집중력', '기억력', '전문성'], text: '강한 집중력과 뛰어난 기억력의 소유자입니다. 한 분야에 깊이 파고드는 전문가 기질이 있습니다.', extra: '깊고 선명한 두뇌선은 정신적 에너지가 풍부하고 강한 의지력을 나타냅니다.' },
            short:  { score: 77, tags: ['직관적', '실행력', '결단력'], text: '직관적이고 빠른 판단력을 가졌습니다. 오래 고민하기보다 즉각적으로 행동하며, 실행력이 뛰어납니다.', extra: '짧은 두뇌선은 핵심을 빠르게 파악하고 즉시 실행하는 능력을 나타냅니다.' }
        },
        fate: {
            long:   { score: 93, tags: ['목표 지향', '성공운', '리더십'], text: '강한 목표 의식과 리더십을 갖추고 있습니다. 인생의 방향이 뚜렷하며, 꾸준한 노력으로 큰 성취를 이룰 수 있습니다.', extra: '뚜렷하게 이어지는 운명선은 매우 강한 의지와 목표 의식을 나타냅니다.' },
            curved: { score: 86, tags: ['자수성가', '노력형', '독립적'], text: '스스로의 힘으로 성공을 이루는 자수성가형입니다. 끈기와 노력으로 반드시 목표를 달성합니다.', extra: '생명선에서 갈라져 나오는 운명선은 자신의 힘으로 길을 개척하는 사람에게 나타납니다.' },
            straight:{ score: 80, tags: ['전환점', '성장형', '발전'], text: '인생의 중반부터 본격적인 성장이 시작됩니다. 경험이 밑거름이 되어 성공에 도달합니다.', extra: '직선형 운명선은 꾸준한 성장을 의미합니다.' },
            short:  { score: 74, tags: ['자유로운 삶', '유연한', '다재다능'], text: '특정 길에 얽매이지 않는 자유로운 영혼입니다. 다양한 분야에 관심이 있으며, 유연하게 인생을 설계해 나갑니다.', extra: '짧은 운명선은 다양한 가능성을 탐색하는 열린 마인드를 나타냅니다.' }
        }
    };

    const summaryMessages = [
        { min: 90, text: '탁월한 손금입니다! 타고난 운과 재능이 조화를 이루고 있습니다.' },
        { min: 80, text: '매우 좋은 손금입니다. 균형 잡힌 기운이 삶의 여러 영역에서 긍정적인 영향을 줍니다.' },
        { min: 70, text: '좋은 손금입니다. 특별한 강점이 보이며, 이를 잘 활용하면 큰 성과를 거둘 수 있습니다.' },
        { min: 60, text: '안정적인 손금입니다. 꾸준한 노력이 좋은 결과로 이어질 기운입니다.' },
        { min: 0, text: '잠재력이 큰 손금입니다. 자신을 믿고 도전하세요.' }
    ];

    // ===== Landmark Indices =====
    const LM = {
        WRIST: 0, THUMB_CMC: 1, THUMB_MCP: 2, THUMB_IP: 3, THUMB_TIP: 4,
        INDEX_MCP: 5, INDEX_PIP: 6, INDEX_DIP: 7, INDEX_TIP: 8,
        MIDDLE_MCP: 9, MIDDLE_PIP: 10, MIDDLE_DIP: 11, MIDDLE_TIP: 12,
        RING_MCP: 13, RING_PIP: 14, RING_DIP: 15, RING_TIP: 16,
        PINKY_MCP: 17, PINKY_PIP: 18, PINKY_DIP: 19, PINKY_TIP: 20
    };

    // ===== Image Handling =====
    let currentImageData = null;

    btnUpload.addEventListener('click', () => fileInput.click());
    btnCamera.addEventListener('click', () => cameraInput.click());
    fileInput.addEventListener('change', handleFileSelect);
    cameraInput.addEventListener('change', handleFileSelect);

    // Drag & Drop
    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('drag-over'); });
    uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('drag-over'); });
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault(); uploadArea.classList.remove('drag-over');
        if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
    });

    function handleFileSelect(e) { if (e.target.files.length > 0) handleFile(e.target.files[0]); }

    function handleFile(file) {
        if (!file.type.startsWith('image/')) { alert('이미지 파일만 업로드할 수 있습니다.'); return; }
        const reader = new FileReader();
        reader.onload = (e) => {
            currentImageData = e.target.result;
            previewImage.src = currentImageData;
            previewImage.onload = () => { setupCanvas(); showSection('preview'); };
        };
        reader.readAsDataURL(file);
    }

    function setupCanvas() {
        overlayCanvas.width = previewImage.naturalWidth;
        overlayCanvas.height = previewImage.naturalHeight;
        overlayCanvas.style.width = '100%';
        overlayCanvas.style.height = '100%';
    }

    // ===== Section Navigation =====
    const uploadCard = document.querySelector('.upload-card');

    function showSection(section) {
        // upload-section: upload, preview, results 모두에서 보임 (previewContainer가 안에 있으므로)
        uploadSection.style.display = (section === 'upload' || section === 'preview' || section === 'results') ? 'block' : 'none';
        uploadCard.style.display = section === 'upload' ? 'block' : 'none';
        previewContainer.style.display = (section === 'preview' || section === 'results') ? 'block' : 'none';
        loadingSection.style.display = section === 'loading' ? 'block' : 'none';
        resultsSection.style.display = section === 'results' ? 'block' : 'none';
    }

    // ===== Analysis =====
    btnAnalyze.addEventListener('click', startAnalysis);
    btnReset.addEventListener('click', resetAll);
    btnRetry.addEventListener('click', () => { resetAll(); window.scrollTo({ top: 0, behavior: 'smooth' }); });

    function resetAll() {
        currentImageData = null; detectedLandmarks = null;
        fileInput.value = ''; cameraInput.value = '';
        lineLegend.style.display = 'none';
        overlayCanvas.getContext('2d').clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
        showSection('upload');
    }

    async function startAnalysis() {
        showSection('loading');
        window.scrollTo({ top: 0, behavior: 'smooth' });

        const loadingProgress = document.getElementById('loadingProgress');
        const loadingStatus = document.getElementById('loadingStatus');

        let currentStage = '';
        try {
        // Stage 1: AI 모델 확인
        currentStage = 'AI 모델 확인';
        loadingStatus.textContent = 'AI 모델을 준비하는 중...';
        loadingProgress.style.width = '10%';

        if (!handLandmarker) {
            loadingStatus.textContent = 'AI 모델을 다운로드하는 중... (최초 1회)';
            await initMediaPipe();
            if (!handLandmarker) {
                loadingStatus.textContent = 'AI 모델 로딩 실패. 새로고침 후 다시 시도해주세요.';
                setTimeout(() => showSection('preview'), 3000);
                return;
            }
        }

        // Stage 2: 손 감지
        currentStage = '손 감지';
        loadingStatus.textContent = 'MediaPipe AI로 손바닥을 감지하는 중...';
        loadingProgress.style.width = '25%';
        await sleep(300);

        console.log("[AI] 이미지 분석 시작:", previewImage.naturalWidth, "x", previewImage.naturalHeight);
        const result = handLandmarker.detect(previewImage);
        console.log("[AI] 분석 결과:", JSON.stringify({
            landmarks: result.landmarks?.length || 0,
            handednesses: result.handednesses?.length || 0
        }));

        if (!result.landmarks || result.landmarks.length === 0) {
            loadingStatus.textContent = '손바닥을 감지하지 못했습니다. 밝은 곳에서 손바닥을 펴고 다시 촬영해주세요.';
            loadingProgress.style.width = '100%';
            loadingProgress.style.background = '#ff4444';
            setTimeout(() => {
                loadingProgress.style.background = '';
                showSection('preview');
            }, 3000);
            return;
        }

        detectedLandmarks = result.landmarks[0]; // 21개 관절점
        handedness = result.handednesses?.[0]?.[0]?.categoryName || 'Unknown';
        console.log("[AI] 손 감지 성공:", handedness, "21개 관절점 확보");

        // Stage 3~7: 손금선 분석 진행 표시
        currentStage = '손금선 계산';
        loadingStatus.textContent = '21개 관절점에서 손금선을 계산하는 중...';
        loadingProgress.style.width = '40%';
        await sleep(300);

        loadingStatus.textContent = '생명선·감정선·두뇌선을 분석하는 중...';
        loadingProgress.style.width = '60%';
        await sleep(300);

        loadingStatus.textContent = '운명선 및 부가 요소를 분석하는 중...';
        loadingProgress.style.width = '80%';
        await sleep(300);

        // 결과 계산
        currentStage = 'computePalmLines';
        console.log("[AI] computePalmLines 시작...");
        const palmLines = computePalmLines(detectedLandmarks);
        console.log("[AI] computePalmLines 완료:", palmLines.length, "개 선");

        currentStage = 'analyzePalmLines';
        console.log("[AI] analyzePalmLines 시작...");
        const analysis = analyzePalmLines(palmLines, detectedLandmarks);
        console.log("[AI] analyzePalmLines 완료:", Object.keys(analysis));

        currentStage = 'applyResults';
        applyResults(analysis);

        loadingStatus.textContent = '종합 해석을 생성하는 중...';
        loadingProgress.style.width = '95%';
        await sleep(200);

        loadingProgress.style.width = '100%';
        await sleep(200);

        // 라인 애니메이션과 함께 결과 표시
        currentStage = 'showResults';
        showSection('results');
        await drawAnimatedOverlay(palmLines);
        animateResults();

        // Gemini AI 정밀 분석 (비동기 - 기본 결과 표시 후 추가)
        callGeminiAnalysis();

        } catch (err) {
            console.error("[AI] 분석 중 오류 (단계: " + currentStage + "):", err);
            loadingStatus.textContent = '분석 중 오류가 발생했습니다. 다시 촬영해주세요. (' + currentStage + ')';
            loadingProgress.style.width = '100%';
            loadingProgress.style.background = '#ff4444';
            setTimeout(() => {
                loadingProgress.style.background = '';
                showSection('preview');
            }, 3000);
        }
    }

    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    // ===== Gemini AI Analysis =====
    const AI_DAILY_LIMIT = 5;
    const AI_STORAGE_KEY = 'palm_ai_usage';

    function getAiUsageToday() {
        try {
            const data = JSON.parse(localStorage.getItem(AI_STORAGE_KEY) || '{}');
            const today = new Date().toISOString().slice(0, 10);
            if (data.date !== today) return 0;
            return data.count || 0;
        } catch { return 0; }
    }

    function incrementAiUsage() {
        const today = new Date().toISOString().slice(0, 10);
        const data = JSON.parse(localStorage.getItem(AI_STORAGE_KEY) || '{}');
        if (data.date !== today) {
            localStorage.setItem(AI_STORAGE_KEY, JSON.stringify({ date: today, count: 1 }));
        } else {
            data.count = (data.count || 0) + 1;
            localStorage.setItem(AI_STORAGE_KEY, JSON.stringify(data));
        }
    }

    async function callGeminiAnalysis() {
        const aiAnalysisSection = document.getElementById('aiAnalysisSection');
        const aiLoadingSection = document.getElementById('aiLoadingSection');
        const aiErrorSection = document.getElementById('aiErrorSection');

        // 클라이언트 사이드 사용량 체크
        if (getAiUsageToday() >= AI_DAILY_LIMIT) {
            aiLoadingSection.style.display = 'none';
            aiAnalysisSection.style.display = 'none';
            aiErrorSection.style.display = 'block';
            return;
        }

        // 로딩 표시
        aiLoadingSection.style.display = 'block';
        aiAnalysisSection.style.display = 'none';
        aiErrorSection.style.display = 'none';

        try {
            const response = await fetch('/api/palm/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ image: currentImageData })
            });

            const data = await response.json();

            if (response.status === 429) {
                // 서버 사이드 제한
                aiLoadingSection.style.display = 'none';
                document.getElementById('aiErrorTitle').textContent = data.message || '오늘의 AI 분석 횟수를 모두 사용했습니다';
                aiErrorSection.style.display = 'block';
                return;
            }

            if (response.status === 503) {
                aiLoadingSection.style.display = 'none';
                document.getElementById('aiErrorTitle').textContent = '분석 요청이 많습니다';
                document.getElementById('aiErrorText').textContent = data.message || '잠시 후 다시 시도해주세요.';
                aiErrorSection.style.display = 'block';
                return;
            }

            if (!response.ok) throw new Error(data.error || 'API error');

            // 성공 - 사용량 증가
            incrementAiUsage();

            // 결과 표시
            displayAiResults(data);

        } catch (err) {
            console.error('[AI] Gemini API error:', err);
            aiLoadingSection.style.display = 'none';
            document.getElementById('aiErrorTitle').textContent = 'AI 분석을 불러올 수 없습니다';
            document.getElementById('aiErrorText').textContent = '네트워크 오류가 발생했습니다. 기본 분석 결과를 참고해주세요.';
            aiErrorSection.style.display = 'block';
        }
    }

    function displayAiResults(data) {
        document.getElementById('aiLoadingSection').style.display = 'none';
        document.getElementById('aiErrorSection').style.display = 'none';

        // AI 결과 채우기
        document.getElementById('aiOverallText').textContent = data.overall || '';
        document.getElementById('aiPersonalityText').textContent = data.personality || '';
        document.getElementById('aiLoveText').textContent = data.love || '';
        document.getElementById('aiCareerText').textContent = data.career || '';
        document.getElementById('aiHealthText').textContent = data.health || '';
        document.getElementById('aiAdviceText').textContent = data.advice || '';

        // 각 선별 AI 분석을 기존 카드의 상세 해설에도 반영
        if (data.lines) {
            const lineMap = {
                heart_line: 'heart',
                head_line: 'head',
                life_line: 'life',
                fate_line: 'fate'
            };
            for (const [apiKey, domKey] of Object.entries(lineMap)) {
                const lineData = data.lines[apiKey];
                if (lineData) {
                    const extraEl = document.getElementById(domKey + 'ExtraContent');
                    if (extraEl) extraEl.innerHTML = '<p style="color:var(--color-gold);font-size:0.8rem;margin-bottom:0.3rem;">AI 분석</p>' + lineData.description;
                }
            }
        }

        // 남은 횟수 표시
        const remaining = data.remaining !== undefined ? data.remaining : (AI_DAILY_LIMIT - getAiUsageToday());
        document.getElementById('aiRemaining').textContent = `오늘 남은 AI 분석 횟수: ${remaining}회 / ${AI_DAILY_LIMIT}회`;

        // 표시
        document.getElementById('aiAnalysisSection').style.display = 'block';

        // 부드러운 스크롤
        document.getElementById('aiAnalysisSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // ===== Compute Palm Lines from Landmarks =====
    function lerp(p1, p2, t) {
        return { x: p1.x + (p2.x - p1.x) * t, y: p1.y + (p2.y - p1.y) * t };
    }

    function computePalmLines(lm) {
        // === 기준점 계산 ===
        const mcpCenterY = (lm[LM.INDEX_MCP].y + lm[LM.MIDDLE_MCP].y + lm[LM.RING_MCP].y + lm[LM.PINKY_MCP].y) / 4;
        const wristY = lm[LM.WRIST].y;
        const palmH = wristY - mcpCenterY; // 손바닥 높이 (양수)

        // 엄지가 어느 쪽인지 판단 (실제 랜드마크 기준)
        const thumbSide = lm[LM.THUMB_CMC].x < lm[LM.PINKY_MCP].x ? -1 : 1;
        // thumbSide: -1이면 엄지가 왼쪽, 1이면 엄지가 오른쪽

        // 새끼손가락~검지 순서 정렬 (항상 새끼→검지 방향으로)
        const pinkyX = lm[LM.PINKY_MCP].x;
        const ringX = lm[LM.RING_MCP].x;
        const midX = lm[LM.MIDDLE_MCP].x;
        const idxX = lm[LM.INDEX_MCP].x;
        const thumbCmcX = lm[LM.THUMB_CMC].x;
        const thumbMcpX = lm[LM.THUMB_MCP].x;

        // ============================================================
        // 감정선 (Heart Line): 새끼손가락 MCP 아래 → 검지 MCP 아래
        // 손가락 뿌리(MCP) 바로 아래, 비교적 수평
        // ============================================================
        const heartY = mcpCenterY + palmH * 0.18;
        const heartLine = {
            name: 'heart', label: '감정선', color: '#FF6B6B',
            points: [
                { x: pinkyX, y: lm[LM.PINKY_MCP].y + palmH * 0.15 },
                { x: (pinkyX + ringX) / 2, y: heartY },
                { x: ringX, y: heartY },
                { x: (ringX + midX) / 2, y: heartY - palmH * 0.01 },
                { x: midX, y: heartY - palmH * 0.02 },
                { x: (midX + idxX) / 2, y: heartY - palmH * 0.04 },
                { x: idxX, y: lm[LM.INDEX_MCP].y + palmH * 0.12 },
            ]
        };

        // ============================================================
        // 두뇌선 (Head Line): 검지 쪽 시작 → 새끼 방향, 약간 하강
        // 감정선 아래, 손바닥 중앙 가로선
        // ============================================================
        const headBaseY = mcpCenterY + palmH * 0.35;
        const headLine = {
            name: 'head', label: '두뇌선', color: '#4ECDC4',
            points: [
                { x: idxX, y: lm[LM.INDEX_MCP].y + palmH * 0.33 },
                { x: (idxX + midX) / 2, y: headBaseY },
                { x: midX, y: headBaseY + palmH * 0.02 },
                { x: (midX + ringX) / 2, y: headBaseY + palmH * 0.05 },
                { x: ringX, y: headBaseY + palmH * 0.08 },
                { x: (ringX + pinkyX) / 2, y: headBaseY + palmH * 0.12 },
            ]
        };

        // ============================================================
        // 생명선 (Life Line): 엄지~검지 사이에서 시작 → 엄지 뿌리를 감싸는 곡선
        // 핵심: 엄지 쪽으로 곡선을 그려야 함 (thumbSide 방향)
        // ============================================================
        // 시작점: 검지 MCP와 엄지 MCP 사이
        const lifeStart = {
            x: (idxX + thumbMcpX) / 2,
            y: lm[LM.INDEX_MCP].y + palmH * 0.28
        };

        // 엄지 뿌리를 따라 손목 방향으로 곡선
        // THUMB_CMC → WRIST 경로를 따르되, 손바닥 안쪽으로 약간 들어오게
        const inward = -thumbSide * palmH * 0.04; // 손바닥 안쪽 방향 오프셋
        const lifeLine = {
            name: 'life', label: '생명선', color: '#45B7D1',
            points: [
                lifeStart,
                { x: thumbMcpX + inward * 0.5, y: lifeStart.y + palmH * 0.10 },
                { x: thumbCmcX + inward * 1.0, y: lm[LM.THUMB_CMC].y + palmH * 0.05 },
                { x: thumbCmcX + inward * 1.5, y: lm[LM.THUMB_CMC].y + palmH * 0.15 },
                { x: thumbCmcX + inward * 2.0, y: lerp(lm[LM.THUMB_CMC], lm[LM.WRIST], 0.5).y },
                { x: thumbCmcX + inward * 2.2, y: lerp(lm[LM.THUMB_CMC], lm[LM.WRIST], 0.7).y },
                { x: lerp(lm[LM.THUMB_CMC], lm[LM.WRIST], 0.85).x + inward * 1.5, y: lerp(lm[LM.THUMB_CMC], lm[LM.WRIST], 0.85).y },
            ]
        };

        // ============================================================
        // 운명선 (Fate Line): 손목 중앙 → 중지 방향 세로
        // ============================================================
        const fateLine = {
            name: 'fate', label: '운명선', color: '#DDA0DD',
            points: [
                lerp(lm[LM.WRIST], lm[LM.MIDDLE_MCP], 0.08),
                lerp(lm[LM.WRIST], lm[LM.MIDDLE_MCP], 0.25),
                lerp(lm[LM.WRIST], lm[LM.MIDDLE_MCP], 0.45),
                lerp(lm[LM.WRIST], lm[LM.MIDDLE_MCP], 0.65),
                lerp(lm[LM.WRIST], lm[LM.MIDDLE_MCP], 0.85),
            ]
        };

        return [heartLine, headLine, lifeLine, fateLine];
    }

    // ===== Analyze Palm Lines (실측 기반) =====
    function dist(p1, p2) {
        return Math.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2);
    }

    function lineLength(points) {
        let len = 0;
        for (let i = 1; i < points.length; i++) len += dist(points[i-1], points[i]);
        return len;
    }

    function curvature(points) {
        if (points.length < 3) return 0;
        const straightDist = dist(points[0], points[points.length - 1]);
        const totalLen = lineLength(points);
        return totalLen > 0 ? (totalLen / straightDist - 1) : 0;
    }

    function analyzePalmLines(palmLines, lm) {
        const results = {};
        const palmSize = dist(lm[LM.WRIST], lm[LM.MIDDLE_MCP]);

        palmLines.forEach(line => {
            const len = lineLength(line.points);
            const curve = curvature(line.points);
            const relLen = len / palmSize; // 손바닥 대비 상대 길이

            let type;
            if (relLen > 0.8 && curve > 0.08) type = 'long';
            else if (relLen > 0.6 && curve > 0.12) type = 'curved';
            else if (relLen > 0.5 && curve < 0.08) type = 'straight';
            else type = 'short';

            const interp = palmInterpretations[line.name][type];

            // 실측값으로 점수 미세 조정
            const lenBonus = Math.round((relLen - 0.5) * 15);
            const curveBonus = Math.round(curve * 30);
            const score = Math.max(60, Math.min(98, interp.score + lenBonus + curveBonus));

            results[line.name] = {
                type, score, ...interp, score,
                measured: {
                    length: relLen.toFixed(2),
                    curvature: curve.toFixed(3),
                    palmSize: palmSize.toFixed(3)
                }
            };
            // 최종 점수를 실측 보정값으로 덮어쓰기
            results[line.name].score = score;
        });

        return results;
    }

    // ===== Apply Results to DOM =====
    function applyResults(analysis) {
        let totalScore = 0;
        ['life', 'heart', 'head', 'fate'].forEach(name => {
            const a = analysis[name];
            totalScore += a.score;
            document.getElementById(name + 'Score').textContent = a.score;
            document.getElementById(name + 'Bar').style.width = a.score + '%';
            document.getElementById(name + 'Tags').innerHTML = a.tags.map(t => `<span class="tag">${t}</span>`).join('');
            document.getElementById(name + 'Text').textContent = a.text;
            document.getElementById(name + 'ExtraContent').textContent = a.extra;
        });

        const avg = Math.round(totalScore / 4);
        document.getElementById('totalScore').textContent = avg;
        document.getElementById('summaryBadge').textContent = `종합 ${avg}점`;

        const circle = document.getElementById('scoreCircle');
        const circumference = 2 * Math.PI * 52;
        const offset = circumference - (circumference * avg / 100);
        setTimeout(() => {
            circle.style.transition = 'stroke-dashoffset 1.5s ease-out';
            circle.style.strokeDashoffset = offset;
        }, 300);

        const msg = summaryMessages.find(m => avg >= m.min);
        document.getElementById('summaryMessage').textContent = msg ? msg.text : '';

        // 부가 분석 - 실측 기반
        if (detectedLandmarks) {
            const lm = detectedLandmarks;

            // 손가락 길이 비율 분석
            const indexLen = dist(lm[LM.INDEX_MCP], lm[LM.INDEX_TIP]);
            const ringLen = dist(lm[LM.RING_MCP], lm[LM.RING_TIP]);
            const middleLen = dist(lm[LM.MIDDLE_MCP], lm[LM.MIDDLE_TIP]);
            const ratio = indexLen / ringLen;

            let fingerText;
            if (ratio > 1.02) fingerText = '검지가 약지보다 긴 편으로 리더십 기질이 돋보입니다. 이 특성을 잘 활용해 보세요.';
            else if (ratio < 0.98) fingerText = '약지가 검지보다 긴 편으로 예술적 감각이 돋보입니다. 이 특성을 잘 활용해 보세요.';
            else fingerText = '검지와 약지가 균형 잡혀 조화로운 성격이 돋보입니다. 이 특성을 잘 활용해 보세요.';
            document.getElementById('fingerText').textContent = fingerText;

            // 손바닥 구(丘) 분석
            const jupiterArea = dist(lm[LM.INDEX_MCP], lm[LM.INDEX_PIP]);
            const moonArea = dist(lm[LM.PINKY_MCP], lm[LM.WRIST]);
            const venusArea = dist(lm[LM.THUMB_CMC], lm[LM.WRIST]);

            let mountText;
            if (venusArea > moonArea && venusArea > jupiterArea) mountText = '금성구(매력)가 풍부하여, 해당 영역에서 강한 기운이 작용하고 있습니다.';
            else if (moonArea > jupiterArea) mountText = '달의 구(직관력)가 발달하여, 해당 영역에서 강한 기운이 작용하고 있습니다.';
            else mountText = '목성구(리더십)가 발달하여, 해당 영역에서 강한 기운이 작용하고 있습니다.';
            document.getElementById('mountText').textContent = mountText;

            // 특수 문양
            const handSpan = dist(lm[LM.INDEX_TIP], lm[LM.PINKY_TIP]);
            const palmW = dist(lm[LM.INDEX_MCP], lm[LM.PINKY_MCP]);
            const spreadRatio = handSpan / palmW;
            let specialText;
            if (spreadRatio > 1.8) specialText = '넓게 펼쳐진 손가락 형태가 감지되어 개방적이고 진취적인 기운이 발견됩니다.';
            else if (spreadRatio > 1.4) specialText = '균형 잡힌 손가락 간격이 감지되어 안정적이고 조화로운 기운이 발견됩니다.';
            else specialText = '모아진 손가락 형태가 감지되어 집중력 있고 신중한 기운이 발견됩니다.';
            document.getElementById('specialText').textContent = specialText;
        }

        // 손잡이 정보 표시
        const handStr = handedness === 'Left' ? '왼손' : handedness === 'Right' ? '오른손' : '손';
        document.getElementById('summaryMessage').textContent =
            `[${handStr} 감지] ` + (msg ? msg.text : '');
    }

    // ===== Animated Palm Line Drawing =====
    async function drawAnimatedOverlay(palmLines) {
        const ctx = overlayCanvas.getContext('2d');
        const w = overlayCanvas.width;
        const h = overlayCanvas.height;
        ctx.clearRect(0, 0, w, h);

        // 반투명 오버레이
        ctx.fillStyle = 'rgba(0, 0, 0, 0.12)';
        ctx.fillRect(0, 0, w, h);

        // 21개 관절점 점 표시 (미세하게)
        if (detectedLandmarks) {
            detectedLandmarks.forEach((lm, i) => {
                const px = lm.x * w, py = lm.y * h;
                ctx.beginPath();
                ctx.arc(px, py, Math.max(2, w * 0.003), 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 215, 0, 0.4)';
                ctx.fill();
            });
        }

        // 각 라인을 순차적으로 애니메이션
        for (const line of palmLines) {
            await animateLine(ctx, line, w, h, 1200);
            await sleep(200);
        }

        lineLegend.style.display = 'flex';
        previewContainer.style.display = 'block';
        previewContainer.style.marginBottom = '2rem';
    }

    function animateLine(ctx, line, imgW, imgH, duration) {
        return new Promise(resolve => {
            const pixelPoints = line.points.map(p => ({ x: p.x * imgW, y: p.y * imgH }));
            const startTime = performance.now();

            function draw(now) {
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1.0);
                // easeInOutCubic
                const eased = progress < 0.5
                    ? 4 * progress * progress * progress
                    : 1 - Math.pow(-2 * progress + 2, 3) / 2;

                // 글로우
                ctx.save();
                ctx.shadowColor = line.color;
                ctx.shadowBlur = 12;
                ctx.strokeStyle = line.color;
                ctx.lineWidth = Math.max(3, imgW * 0.004);
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.globalAlpha = 0.6;
                drawPartialCurve(ctx, pixelPoints, eased);
                ctx.restore();

                // 메인 라인
                ctx.strokeStyle = line.color;
                ctx.lineWidth = Math.max(2, imgW * 0.003);
                ctx.lineCap = 'round';
                ctx.globalAlpha = 1;
                drawPartialCurve(ctx, pixelPoints, eased);

                if (progress < 1.0) {
                    requestAnimationFrame(draw);
                } else {
                    // 라벨
                    const lp = pixelPoints[1] || pixelPoints[0];
                    const fontSize = Math.max(12, imgW * 0.022);
                    ctx.font = `bold ${fontSize}px "Noto Sans KR", sans-serif`;
                    ctx.fillStyle = line.color;
                    ctx.shadowColor = 'rgba(0,0,0,0.8)';
                    ctx.shadowBlur = 4;
                    ctx.fillText(line.label, lp.x + 8, lp.y - 8);
                    ctx.shadowBlur = 0;
                    resolve();
                }
            }
            requestAnimationFrame(draw);
        });
    }

    function drawPartialCurve(ctx, points, progress) {
        if (points.length < 2) return;
        const totalPts = Math.max(2, Math.floor(points.length * progress));
        ctx.beginPath();
        ctx.moveTo(points[0].x, points[0].y);
        for (let i = 1; i < totalPts - 1; i++) {
            const xc = (points[i].x + points[i + 1].x) / 2;
            const yc = (points[i].y + points[i + 1].y) / 2;
            ctx.quadraticCurveTo(points[i].x, points[i].y, xc, yc);
        }
        if (totalPts >= 2) {
            const last = points[totalPts - 1];
            ctx.lineTo(last.x, last.y);
        }
        ctx.stroke();
    }

    // ===== Animate Results =====
    function animateResults() {
        const cards = resultsSection.querySelectorAll('.line-card, .result-summary-card, .additional-card');
        cards.forEach((card, i) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            setTimeout(() => {
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, i * 120);
        });
        setTimeout(() => {
            ['life', 'heart', 'head', 'fate'].forEach(line => {
                const bar = document.getElementById(line + 'Bar');
                const target = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => { bar.style.transition = 'width 1s ease-out'; bar.style.width = target; }, 100);
            });
        }, 400);
    }

    // ===== Line card expand/collapse =====
    document.querySelectorAll('.line-card').forEach(card => {
        card.addEventListener('click', function(e) {
            if (e.target.closest('.line-extra')) return;
            this.classList.toggle('expanded');
        });
    });

    // ===== Scroll Animations =====
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
    }, { threshold: 0.1 });
    document.querySelectorAll('.guide-card, .sign-item, .additional-card').forEach(el => observer.observe(el));

    </script>

</body>
</html>
